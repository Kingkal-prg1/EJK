<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EJK Hub - Launcher (Enhanced)</title>
    
    <!-- PWA Manifest Link -->
    <link rel="manifest" href="manifest.json">
    
    <!-- External Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Removed redundant particles.js, as a custom one is implemented -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <style>
        /* 648k is the best? */
        /* Global & Reset */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Poppins:wght@400;600;800&display.swap');
        :root {
            --primary-color: #00ffff;
            --background-color: #0d0d0d;
            --card-background: rgba(20, 25, 40, 0.6);
            --glow-color: rgba(0, 255, 255, 0.5);
            --favorite-color: #ff4500;
            --success-color: #22c55e;
            --error-color: #ef4444;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        html, body {
            height: 100%; overflow-x: hidden;
            font-family: 'Poppins', sans-serif;
            background-color: var(--background-color);
            color: #fff;
            position: relative;
        }

        /* Particle/Canvas Background */
        #particle-canvas {
            position: fixed;
            inset: 0;
            z-index: 0;
        }

        /* Main App Structure */
        #app-container {
            position: relative;
            z-index: 10;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            padding-top: 20px;
        }

        /* Tab Navigation */
        .tab-nav {
            display: flex;
            justify-content: center;
            padding: 15px 0;
            gap: 15px;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(8px);
            border-bottom: 2px solid rgba(0,255,255,0.2);
            position: sticky;
            top: 0;
            z-index: 20;
            animation: fadeDown 0.8s ease forwards;
        }

        .tab-nav-btn {
            padding: 10px 25px;
            font-size: 1.1rem;
            font-weight: 700;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #fff;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(0,255,255,0.3);
        }

        .tab-nav-btn:hover {
            background: rgba(0,255,255,0.2);
            box-shadow: 0 0 10px var(--glow-color);
        }

        .tab-nav-btn.active {
            background: var(--primary-color);
            box-shadow: 0 0 25px var(--primary-color), 0 0 45px rgba(0, 255, 255, 0.5); 
            color: #000;
            transform: scale(1.05);
        }

        /* Views */
        .app-view {
            display: none;
            padding: 20px 0 80px;
            width: 100%;
            flex-grow: 1;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
        }
        .app-view.active {
            display: flex;
            flex-direction: column;
            align-items: center;
            opacity: 1;
            transform: translateY(0);
        }

        /* Home View Styles */
        #home-view {
            min-height: calc(100vh - 80px); 
            text-align: center;
        }
        #home-view .welcome-banner {
            font-family: 'Inter', sans-serif;
            font-size: clamp(3rem, 10vw, 8rem);
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 6px;
            margin-bottom: 50px;
            color: #fff;
            animation: pulseGlow 3s infinite ease-in-out;
            position: relative;
            cursor: pointer;
        }
         /* NEW: Style for editable welcome banner */
        #home-view .welcome-banner[contenteditable="true"] {
            outline: 2px dashed var(--primary-color);
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            cursor: text;
        }

        .home-button-group {
            display: flex;
            gap: 25px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 50px;
        }
        .home-action-button {
            padding: 15px 40px;
            font-size: 1.2rem;
            font-weight: 700;
            text-transform: uppercase;
            border: 2px solid #ffffffaa;
            color: #ffffff;
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            backdrop-filter: blur(4px);
            box-shadow: 0 0 20px rgba(255,255,255,0.2);
            transition: all 0.3s ease;
        }
        .home-action-button:hover {
            background: linear-gradient(135deg, #007bff, #00d4ff);
            border-color: transparent;
            box-shadow: 0 0 25px #00d4ff, 0 0 45px #007bff;
            transform: translateY(-4px) scale(1.05);
        }
        /* Utility classes for buttons */
        .btn-danger {
            background: var(--error-color) !important;
            color: #fff !important;
            border-color: var(--error-color) !important;
        }
        .btn-danger:hover {
            box-shadow: 0 0 25px var(--error-color);
        }
        .btn-secondary {
            background: #6c757d !important;
            color: #fff !important;
            border-color: #6c757d !important;
        }
        .btn-secondary:hover {
            box-shadow: 0 0 25px #6c757d;
        }


        .section-title {
            width: 90%;
            max-width: 1400px;
            text-align: left;
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--primary-color);
            margin: 40px 0 20px;
            padding-left: 10px;
            border-left: 4px solid var(--primary-color);
            text-shadow: 0 0 10px rgba(0,255,255,0.2);
        }
        
        .empty-state {
            color: #aaa;
            padding: 20px;
            font-style: italic;
        }

        /* Search Bar */
        .search-bar {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            width: 100%;
        }
        .search-bar input {
            width: 500px;
            max-width: 90%;
            padding: 12px 25px;
            border-radius: 30px;
            border: 1px solid rgba(0,255,255,0.3);
            outline: none;
            background: var(--card-background);
            color: #fff;
            font-size: 1rem;
            text-align: center;
            box-shadow: 0 0 15px rgba(0,255,255,0.1);
            backdrop-filter: blur(8px);
            transition: all 0.3s ease;
        }
        .search-bar input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 25px var(--glow-color);
        }

        /* Card Container */
        .content-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 30px;
            padding: 0 40px;
            width: 100%;
            max-width: 1400px;
        }
        .content-container-small {
            display: flex;
            overflow-x: auto;
            gap: 20px;
            padding: 0 40px 20px;
            width: 100%;
            max-width: 1400px;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .content-container-small::-webkit-scrollbar {
            display: none;
        }

        /* Card Styles */
        .content-card {
            background: var(--card-background);
            border-radius: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(0,255,255,0.2);
            opacity: 0;
            transform: translateY(30px) scale(0.95);
            min-width: 180px;
        }
        .content-card.visible {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
        .content-card[data-type="game"] { 
            min-width: 200px;
        }


        .card-img-container {
            width: 100%;
            height: 150px; 
            aspect-ratio: 2 / 3;
            overflow: hidden;
            border-radius: 20px 20px 0 0;
            position: relative;
        }
        .content-card[data-type="movie"] .card-img-container {
             height: auto;
        }
        
        .content-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: all 0.4s ease;
        }

        .card-overlay {
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.4s ease;
            font-size: 3rem;
            color: var(--primary-color);
            text-shadow: 0 0 10px var(--glow-color);
        }
        .content-card h3 {
            padding: 15px 10px;
            font-size: 1.1rem;
            font-weight: 600;
            color: #eee;
            text-shadow: 0 0 8px rgba(0,0,0,0.5);
            height: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .highlight {
            background-color: yellow;
            color: #000;
            padding: 0 2px;
            border-radius: 3px;
            font-weight: 700;
        }

        .content-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px var(--glow-color);
        }
        .content-card:hover img {
            transform: scale(1.05);
        }
        .content-card:hover .card-overlay {
            opacity: 1;
        }
        
        /* Favorite Heart Icon */
        .favorite-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 5;
            color: #fff;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-shadow: 0 0 5px rgba(0,0,0,0.8);
        }
        .favorite-btn.favorited {
            color: var(--favorite-color);
            text-shadow: 0 0 10px var(--favorite-color);
            animation: pulseHeart 0.5s ease;
        }
        .favorite-btn:hover {
            transform: scale(1.2);
        }
        
        /* Admin Tools Menu in Card */
        .admin-tools-btn {
            position: absolute;
            bottom: 5px;
            right: 5px;
            z-index: 5;
            color: #aaa;
            font-size: 1.2rem;
            padding: 5px;
            background: rgba(0,0,0,0.6);
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: none;
        }
        .admin-tools-btn:hover {
            color: var(--primary-color);
        }
        .admin-tools-btn.active {
            display: block;
        }
        
        .admin-card-menu {
            position: absolute;
            bottom: 40px;
            right: 5px;
            z-index: 10;
            background: #111;
            border: 1px solid var(--primary-color);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 0 15px rgba(0,255,255,0.5);
        }
        .admin-card-menu button {
            display: block;
            width: 100%;
            padding: 8px 15px;
            text-align: left;
            background: transparent;
            color: #eee;
            border: none;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.2s ease;
        }
        .admin-card-menu button:hover {
            background: rgba(0,255,255,0.2);
        }


        /* Media Player Overlay */
        #media-player {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(5,5,5,1);
            flex-direction: column;
            z-index: 50;
            animation: playerFadeIn 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }
        #media-player iframe {
            flex: 1;
            border: none;
            width: 100%;
            height: 100%;
        }
        .player-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0,0,0,0.8);
            padding: 8px 15px;
            box-shadow: 0 0 15px rgba(0,255,255,0.15);
            backdrop-filter: blur(5px);
            position: relative;
        }
        .player-controls button {
            background: linear-gradient(90deg, #00ffff, #007bff);
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.9rem;
            color: #000;
            transition: all 0.3s ease;
        }
        .player-controls button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 10px #00ffff;
        }
        .player-controls .back-btn {
             background: var(--favorite-color);
             color: #fff;
        }
        .player-controls .back-btn:hover {
            box-shadow: 0 0 10px var(--favorite-color);
        }


        /* Modal Styles */
        .app-modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.85);
            z-index: 60;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.5s ease forwards;
        }
        .app-modal .modal-content {
            background: rgba(20,20,20,0.95);
            padding: 30px;
            border-radius: 12px;
            border: 1px solid var(--primary-color);
            box-shadow: 0 0 30px var(--glow-color);
            text-align: left;
            animation: fadeIn 0.8s ease forwards;
            width: 90%;
            max-width: 500px;
            position: relative;
            backdrop-filter: blur(10px);
        }
        .app-modal h3 {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-color);
            border-bottom: 1px solid #222;
            margin-bottom: 15px;
            padding-bottom: 8px;
            text-align: center;
        }
        
        /* Game Info Modal */
        #gameInfoModal .game-details p {
            margin-bottom: 8px;
            font-size: 1rem;
            line-height: 1.4;
        }
        #gameInfoModal .game-details strong {
            color: var(--primary-color);
            font-weight: 700;
        }
        #gameInfoModal .modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        #gameInfoModal .modal-actions button {
            flex-grow: 1;
            font-size: 1.1rem;
        }
        
        /* NEW: Confirmation Modal */
        #confirm-modal .modal-content {
            max-width: 400px;
            text-align: center;
        }
        #confirm-message {
            font-size: 1.1rem;
            margin-bottom: 25px;
            line-height: 1.6;
        }
        .confirm-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        .confirm-actions button {
            flex: 1;
            padding: 10px 20px !important;
            font-size: 1rem !important;
        }

        /* Admin View */
        #admin-view .admin-form-container {
            width: 90%;
            max-width: 800px;
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 40px;
        }
        .admin-form {
            flex: 1 1 350px;
            padding: 25px;
            background: var(--card-background);
            border-radius: 15px;
            border: 1px solid rgba(0,255,255,0.3);
            backdrop-filter: blur(5px);
        }
        .admin-form h3 {
             font-size: 1.5rem;
             color: var(--favorite-color);
             margin-bottom: 15px;
             padding-bottom: 5px;
             border-bottom: 2px solid var(--favorite-color);
        }
        /* Shared form styles for admin and edit modal */
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #555;
            background: #222;
            color: #fff;
            outline: none;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 10px var(--glow-color);
        }
        .admin-form button, #editForm button {
            width: 100%;
            margin-top: 10px;
            padding: 12px;
            font-size: 1.1rem;
        }
        .admin-error-message {
            color: var(--error-color);
            font-weight: bold;
            margin-top: 10px;
            min-height: 1.2em;
        }
        
        /* NEW: Edit Modal */
        #edit-modal .modal-content {
            max-width: 600px;
        }
        #editForm h3 {
             color: var(--primary-color);
             border-bottom-color: var(--primary-color);
        }


        /* Info View */
        #info-view {
            align-items: center;
        }
        .info-modal {
            display: flex;
            width: 90%;
            max-width: 900px;
            background: rgba(20, 25, 40, 0.8);
            border-radius: 15px;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.3);
            overflow: hidden;
            min-height: 450px;
            margin-top: 20px;
        }
        .info-nav {
            flex: 0 0 250px;
            background: rgba(0, 0, 0, 0.5);
            padding: 20px 0;
            border-right: 1px solid rgba(0, 255, 255, 0.2);
        }
        .info-nav button {
            display: block;
            width: 100%;
            padding: 15px 20px;
            text-align: left;
            border: none;
            background: transparent;
            color: #fff;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s ease, color 0.3s ease;
        }
        .info-nav button:hover {
            background: rgba(0, 255, 255, 0.1);
        }
        .info-nav button.active {
            background: var(--primary-color);
            color: #0d0d0d;
        }
        #infoContentArea {
            flex-grow: 1;
            padding: 30px;
        }
        
        /* Footer */
        .footer-text {
            position: fixed;
            bottom: 15px;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 0.9rem;
            color: #ffffffaa;
            letter-spacing: 1px;
            z-index: 10;
        }
        
        /* NEW: Toast Notification */
        #toast-notification {
            position: fixed;
            bottom: -100px; /* Start off-screen */
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 25px;
            border-radius: 30px;
            font-weight: 600;
            color: #000;
            z-index: 100;
            transition: bottom 0.5s ease-in-out;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        #toast-notification.show {
            bottom: 30px;
        }
        #toast-notification.success {
            background-color: var(--success-color);
            box-shadow: 0 0 20px var(--success-color);
        }
        #toast-notification.error {
            background-color: var(--error-color);
            box-shadow: 0 0 20px var(--error-color);
            color: #fff;
        }


        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeDown {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes pulseGlow {
            0%, 100% { text-shadow: 0 0 15px #ffffff88, 0 0 30px #ffffff44; }
            50% { text-shadow: 0 0 25px #ffffffcc, 0 0 60px #ffffff99; }
        }
        @keyframes playerFadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        @keyframes pulseHeart {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }

        /* Media Queries */
        @media (max-width: 768px) {
            #home-view .welcome-banner { font-size: 4rem; margin-bottom: 30px; }
            .home-button-group { flex-direction: column; gap: 15px; }
            .content-container { grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); padding: 0 20px; }
            .content-container-small { padding: 0 20px; }
            #admin-view .admin-form-container { flex-direction: column; }
            
            .info-modal { flex-direction: column; min-height: 60vh;}
            .info-nav { flex: none; width: 100%; padding: 10px; border-right: none; border-bottom: 1px solid rgba(0, 255, 255, 0.2); }
            .info-nav button { padding: 10px 15px; }
            #infoContentArea { padding: 20px; }
        }

    </style>
</head>
<body>

    <!-- Unified Particle System -->
    <canvas id="particle-canvas"></canvas>
    
    <div id="app-container">
        
        <!-- Tab Navigation Bar -->
        <div class="tab-nav">
            <button class="tab-nav-btn active" data-view="home"><i class="fas fa-home"></i> Home</button>
            <button class="tab-nav-btn" data-view="games"><i class="fas fa-gamepad"></i> Games Hub</button>
            <button class="tab-nav-btn" data-view="movies"><i class="fas fa-film"></i> Movies Hub</button>
            <button class="tab-nav-btn" data-view="admin"><i class="fas fa-user-shield"></i> Admin Panel</button>
            <button class="tab-nav-btn" data-view="info"><i class="fas fa-chart-bar"></i> Info</button>
        </div>

        <!-- 1. Home View -->
        <div id="home-view" class="app-view active">
            <!-- NEW: Editable Welcome Message -->
            <h1 class="welcome-banner mt-20" id="welcome-banner" title="Click to edit name">Welcome, User!</h1>
            <div class="home-button-group">
                <button id="installAppBtn" class="home-action-button" style="display:none;" onclick="handleInstallPrompt()">
                    <i class="fas fa-download mr-2"></i> Install App
                </button>
                <button class="home-action-button" onclick="changeView('games')">
                    <i class="fas fa-gamepad mr-2"></i> Quick Launch Games
                </button>
                <button class="home-action-button" onclick="changeView('movies')">
                    <i class="fas fa-film mr-2"></i> Watch Movies
                </button>
                <button class="home-action-button" onclick="showCredits()">
                    <i class="fas fa-info-circle mr-2"></i> Credits
                </button>
            </div>
            
            <h2 class="section-title"><i class="fas fa-history mr-2"></i> Recently Played</h2>
            <div class="content-container-small" id="recentlyPlayedContainer">
                 <div class="empty-state">No games played yet. Go play something!</div>
            </div>

            <!-- UPDATED: Title changed -->
            <h2 class="section-title"><i class="fas fa-heart mr-2"></i> My Favorites</h2>
            <div class="content-container-small" id="favoriteGamesContainer">
                 <!-- UPDATED: Empty state message -->
                 <div class="empty-state">Heart some games or movies to see them here!</div>
            </div>
            
        </div>

        <!-- 2. Games View -->
        <div id="games-view" class="app-view">
            <h2 class="section-title">Games Library</h2>
            <div class="search-bar">
                <input type="text" id="gameSearchInput" placeholder="Search game titles or descriptions...">
            </div>
            <div class="tabs-container mb-6 flex flex-wrap justify-center gap-2">
                <button class="tab-btn-game active home-action-button !text-sm !py-2 !px-4 !font-normal" data-category="All">All</button>
                <button class="tab-btn-game home-action-button !text-sm !py-2 !px-4 !font-normal" data-category="Sports">Sports</button>
                <button class="tab-btn-game home-action-button !text-sm !py-2 !px-4 !font-normal" data-category="Arcade">Arcade</button>
                <button class="tab-btn-game home-action-button !text-sm !py-2 !px-4 !font-normal" data-category="Action">Action</button>
                <button class="tab-btn-game home-action-button !text-sm !py-2 !px-4 !font-normal" data-category="Endless Runner">Endless Runner</button>
            </div>
            <div class="content-container" id="gamesContainer"></div>
        </div>

        <!-- 3. Movies View -->
        <div id="movies-view" class="app-view">
            <h2 class="section-title">Movie Library</h2>
            <div class="search-bar">
                <input type="text" id="movieSearchInput" placeholder="Search movie titles or descriptions...">
            </div>
            <div class="content-container" id="moviesContainer"></div>
        </div>

        <!-- 4. Admin Panel View -->
        <div id="admin-view" class="app-view">
            <h2 class="section-title">Content Management Panel</h2>
            <p class="text-center mb-10 text-gray-400">Add new games and movies to the hub. Data will be saved locally in your browser.</p>
            
            <div class="admin-form-container">
                
                <!-- Add Game Form -->
                <form id="addGameForm" class="admin-form" onsubmit="event.preventDefault(); addContent('game', this);">
                    <h3>Add New Game</h3>
                    <div id="game-error" class="admin-error-message"></div>
                    <div class="form-group">
                        <label for="gameName">Name:</label>
                        <input type="text" id="gameName" name="name" required>
                    </div>
                    <div class="form-group">
                        <label for="gameDescription">Description:</label>
                        <textarea id="gameDescription" name="description" rows="3" class="resize-none"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="gameUrl">Game URL:</label>
                        <input type="text" id="gameUrl" name="url" required>
                    </div>
                    <div class="form-group">
                        <label for="gameIcon">Icon URL (Image for card):</label>
                        <input type="url" id="gameIcon" name="icon" required>
                    </div>
                    <div class="form-group">
                        <label for="gameCategory">Category:</label>
                        <select id="gameCategory" name="category" required>
                            <option value="Sports">Sports</option>
                            <option value="Arcade">Arcade</option>
                            <option value="Action">Action</option>
                            <option value="Endless Runner">Endless Runner</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <button type="submit" class="home-action-button !text-sm !font-bold">Add Game</button>
                </form>

                <!-- Add Movie Form -->
                <form id="addMovieForm" class="admin-form" onsubmit="event.preventDefault(); addContent('movie', this);">
                    <h3>Add New Movie</h3>
                    <div id="movie-error" class="admin-error-message"></div>
                    <div class="form-group">
                        <label for="movieName">Name:</label>
                        <input type="text" id="movieName" name="name" required>
                    </div>
                    <div class="form-group">
                        <label for="movieDescription">Description:</label>
                        <textarea id="movieDescription" name="description" rows="3" class="resize-none"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="movieUrl">Movie/Video URL (Embed/Direct MP4):</label>
                        <input type="text" id="movieUrl" name="url" required>
                    </div>
                    <div class="form-group">
                        <label for="moviePoster">Poster URL (Image for card):</label>
                        <input type="url" id="moviePoster" name="poster" required>
                    </div>
                    <button type="submit" class="home-action-button !text-sm !font-bold">Add Movie</button>
                </form>
            </div>
        </div>
        
        <!-- 5. Info View -->
        <div id="info-view" class="app-view">
            <h2 class="section-title text-center">Hub Information</h2>
            <div id="info-modal" class="info-modal">
                <div class="info-nav">
                    <button class="info-tab-btn active" data-tab="player-counter" onclick="renderInfoModal('player-counter')">
                        <i class="fas fa-chart-line mr-2"></i> Player Sessions
                    </button>
                    <button class="info-tab-btn" data-tab="owners" onclick="renderInfoModal('owners')">
                        <i class="fas fa-users mr-2"></i> Owners & Partners
                    </button>
                </div>
                <div id="infoContentArea">
                    <!-- Dynamic content will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Game Information Modal -->
        <div id="gameInfoModal" class="app-modal" onclick="if(event.target.id === 'gameInfoModal') hideGameInfoModal()">
             <div class="modal-content" onclick="event.stopPropagation()">
                <img id="gameInfoIcon" class="w-24 h-24 object-cover rounded-lg mx-auto mb-4 border-4 border-cyan-500 shadow-lg" alt="Game Icon">
                <h3 id="gameInfoName" class="text-3xl font-extrabold mb-4"></h3>
                <div class="game-details text-gray-300">
                    <p><strong>Category:</strong> <span id="gameInfoCategory"></span></p>
                    <p><strong>Play Count:</strong> <span id="gameInfoPlayCount"></span></p>
                    <p class="mt-4 border-t border-gray-700 pt-4"><strong>Description:</strong> <br><span id="gameInfoDescription" class="italic text-sm text-gray-400"></span></p>
                </div>
                <div class="modal-actions">
                    <button id="modalPlayBtn" class="home-action-button !py-3 !px-6 !text-lg !font-bold">
                        <i class="fas fa-play mr-2"></i> Play Game
                    </button>
                    <button id="modalFavBtn" class="home-action-button !py-3 !px-6 !text-lg !font-bold !bg-transparent !border-red-500 !text-red-500 hover:!bg-red-500/20 hover:!shadow-red-500/50">
                        <i class="fas fa-heart mr-2"></i> 
                        <span id="modalFavText">Add to Favorites</span>
                    </button>
                </div>
             </div>
        </div>


        <!-- Player Overlay (Unified for Game/Movie) -->
        <div id="media-player">
            <div class="player-controls">
                <button id="backBtn" class="back-btn"><i class="fas fa-times mr-2"></i> Exit</button>
                <span class="text-xs text-gray-400">If media is blank, check your URL format or host settings.</span>
                <button id="fullscreenBtn"><i class="fas fa-expand mr-2"></i> Fullscreen</button>
            </div>
            <iframe id="mediaFrame" allowfullscreen></iframe>
        </div>

        <!-- Credits Modal -->
        <div id="credit-modal" class="app-modal" onclick="if(event.target.id === 'credit-modal') hideCredits()">
            <div class="modal-content">
                <h3>Credits</h3>
                <p><strong>Design & Concept:</strong> EJK Community</p>
                <p><strong>Frontend Logic:</strong> _648k 💫</p>
                <p><strong>Particle System:</strong> Kevin (he's the best)</p>
                <button class="home-action-button w-full mt-4" onclick="hideCredits()">Close</button>
            </div>
        </div>
        
        <!-- NEW: Edit Content Modal -->
        <div id="edit-modal" class="app-modal" onclick="if(event.target.id === 'edit-modal') hideEditModal()">
            <div class="modal-content">
                 <form id="editForm" onsubmit="event.preventDefault(); handleEditSubmit(this);">
                    <h3>Edit Content</h3>
                    <div id="edit-error" class="admin-error-message"></div>
                    
                    <!-- Hidden fields to store item context -->
                    <input type="hidden" id="edit-id" name="id">
                    <input type="hidden" id="edit-type" name="type">
                    
                    <div class="form-group">
                        <label for="edit-name">Name:</label>
                        <input type="text" id="edit-name" name="name" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-description">Description:</label>
                        <textarea id="edit-description" name="description" rows="3" class="resize-none"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="edit-url">Game/Movie URL:</label>
                        <input type="text" id="edit-url" name="url" required>
                    </div>
                    <div class="form-group">
                        <label id="edit-image-label" for="edit-image-url">Icon/Poster URL:</label>
                        <input type="url" id="edit-image-url" name="imageUrl" required>
                    </div>
                    <div class="form-group" id="edit-category-group">
                        <label for="edit-category">Category:</label>
                        <select id="edit-category" name="category">
                            <option value="Sports">Sports</option>
                            <option value="Arcade">Arcade</option>
                            <option value="Action">Action</option>
                            <option value="Endless Runner">Endless Runner</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <button type="submit" class="home-action-button !text-sm !font-bold">Save Changes</button>
                </form>
            </div>
        </div>
        
        <!-- NEW: Confirmation Modal -->
        <div id="confirm-modal" class="app-modal" onclick="if(event.target.id === 'confirm-modal') hideConfirm()">
             <div class="modal-content" onclick="event.stopPropagation()">
                <h3>Are you sure?</h3>
                <p id="confirm-message">This action cannot be undone.</p>
                <div class="confirm-actions">
                    <button id="confirm-btn-no" class="home-action-button btn-secondary">Cancel</button>
                    <button id="confirm-btn-yes" class="home-action-button btn-danger">Confirm</button>
                </div>
             </div>
        </div>
        
        <!-- NEW: Toast Notification Element -->
        <div id="toast-notification"></div>
        
        <div class="footer-text">made by the students, for the students ✨</div>

    </div>

    <script>
        // --- INITIAL/FALLBACK DATA ---
        const initialGames = [
            { id: "game-1", name: "Basketball Stars", icon: "https://tse1.mm.bing.net/th/id/OIP.RlzsAtxQOGirwBPxPlmeXwHaE6", url: "https://d11jzht7mj96rr.cloudfront.net/games/2024/gm/basketball-stars/index.html", category: "Sports", playCount: 5, description: "Fast-paced 2-on-2 basketball action. Test your skills against the computer or a friend! Great fun for quick breaks." },
            { id: "game-2", name: "Basket Random", icon: "https://tse3.mm.bing.net/th/id/OIP.0CH4psy303aX_PqXYqbDcQAAAA", url: "https://d11jzht7mj96rr.cloudfront.com/games/2025/construct/320/basket-random-pro/index.html", category: "Sports", playCount: 8, description: "A hilarious and random physics-based basketball game. Control two players and score with unique challenges." },
            { id: "game-3", name: "Moto X3M Pool Party", icon: "https://tse3.mm.bing.net/th/id/OIP.dRzWkpSxwM2-opITBOdcKQHaE8", url: "https://d11jzht7mj96rr.cloudfront.net/games/2024/gm/moto-x3m-pool-party/index.html", category: "Sports", playCount: 15, description: "Crazy motorbike stunt game with summer-themed levels. Perform flips and tricks to lower your time!" },
            { id: "game-4", name: "Retro Bowl", icon: "https://codehs.com/uploads/307d981e1178a3ff863f0db0b0d97e75", url: "https://lonewolf454e.github.io/retro-bowl/", category: "Sports", playCount: 20, description: "Manage your American Football team and win the ultimate prize. A simple yet addictive football sim." },
            { id: "game-5", name: "Capy Clicker", icon: "https://codehs.com/uploads/4e2db92ddcc6fa88e5956dcbf3cb25d9", url: "https://d11jzht7mj96rr.cloudfront.net/games/2023/q2/capy-cutie-clicker/index.html", category: "Arcade", playCount: 5, description: "An idle clicker game where you collect points by clicking a cute capybara. Upgrade your clicks for massive gains!" },
        ];

        const initialMovies = [
            { id: "movie-1", name: "Dune Part 2", poster: "https://codehs.com/uploads/8043fe64a0ca8b261ce7cfa5c761235c", url: "https://www.youtube.com/embed/SY0-Q0b0h8A", description: "The second part of the sci-fi epic saga. Highly anticipated and beautifully filmed. (Trailer link provided due to file size limits)" },
            { id: "movie-2", name: "Frozen", poster: "https://codehs.com/uploads/19f46757c61797e54a82e807e769addb", url: "https://www.youtube.com/embed/TbWmHj30-3M", description: "The classic Disney animated hit. (Trailer link provided)" },
            { id: "movie-3", name: "I.T", poster: "https://codehs.com/uploads/169d03314655a406cd061428a27ded75", url: "https://www.youtube.com/embed/a70w20dO7e8", description: "A suspenseful tech thriller. (Trailer link provided)" },
            { id: "movie-4", name: "Jurassic Park", poster: "https://codehs.com/uploads/33e374e19abcae753770f5f3e17fc659", url: "https://www.youtube.com/embed/lc0Uhd0tTzo", description: "The original dinosaur classic. An adventure 65 million years in the making. (Trailer link provided)" }
        ];
        
        let games = [];
        let movies = [];
        let activeAdminMenu = null;
        let username = 'User'; // NEW: Default username

        // --- LOCAL STORAGE & DATA MANAGEMENT ---
        let favorites = JSON.parse(localStorage.getItem('ejkFavorites')) || [];
        let recentlyPlayed = JSON.parse(localStorage.getItem('ejkRecentlyPlayed')) || [];
        let sessionCount = parseInt(localStorage.getItem('ejkSessionCount')) || 0;
        
        let filters = JSON.parse(localStorage.getItem('ejkFilters')) || {
            gameSearch: '',
            gameCategory: 'All',
            movieSearch: '',
            lastView: 'home'
        };

        function incrementSessionCount() {
            sessionCount++;
            localStorage.setItem('ejkSessionCount', sessionCount);
        }

        function saveFilterState() {
            const gameSearchInput = document.getElementById('gameSearchInput');
            const movieSearchInput = document.getElementById('movieSearchInput');
            
            if (gameSearchInput && movieSearchInput) {
                filters.gameSearch = gameSearchInput.value;
                filters.movieSearch = movieSearchInput.value;
            }
            filters.lastView = document.querySelector('.app-view.active')?.id.replace('-view', '') || 'home';
            localStorage.setItem('ejkFilters', JSON.stringify(filters));
        }

        function loadContentFromStorage() {
            const storedGames = localStorage.getItem('ejkGames');
            const storedMovies = localStorage.getItem('ejkMovies');

            games = storedGames ? JSON.parse(storedGames) : initialGames;
            movies = storedMovies ? JSON.parse(storedMovies) : initialMovies;
            
            games.forEach(g => {
                if (typeof g.playCount !== 'number') { g.playCount = 0; }
                if (typeof g.description !== 'string') { g.description = 'No description available.'; }
            });
            movies.forEach(m => {
                if (typeof m.description !== 'string') { m.description = 'No description available.'; }
            });
            
            // NEW: Load username
            username = localStorage.getItem('ejkUsername') || 'User';
            welcomeBanner.textContent = `Welcome, ${username}!`;
        }

        function saveContentToStorage() {
            localStorage.setItem('ejkFavorites', JSON.stringify(favorites));
            localStorage.setItem('ejkRecentlyPlayed', JSON.stringify(recentlyPlayed));
            localStorage.setItem('ejkGames', JSON.stringify(games));
            localStorage.setItem('ejkMovies', JSON.stringify(movies));
            localStorage.setItem('ejkUsername', username); // NEW: Save username
            saveFilterState(); 
        }
        
        function toggleFavorite(id, type) {
            const index = favorites.indexOf(id);
            if (index > -1) {
                favorites.splice(index, 1); 
            } else {
                favorites.push(id); 
            }
            saveContentToStorage();
            if (type === 'game') {
                 loadAndRenderGames();
            } else {
                 loadAndRenderMovies();
            }
            renderHomeContent(); 
        }
        
        function logRecentGame(gameId) {
            recentlyPlayed = recentlyPlayed.filter(id => id !== gameId);
            recentlyPlayed.unshift(gameId);
            recentlyPlayed = recentlyPlayed.slice(0, 5);
            saveContentToStorage();
            renderHomeContent();
        }
        
        function getGameData(id) {
            return games.find(g => g.id === id);
        }
        function getMovieData(id) {
            return movies.find(m => m.id === id);
        }
        function getContentData(id, type) {
            return type === 'game' ? getGameData(id) : getMovieData(id);
        }

        // --- DOM ELEMENTS ---
        const tabBtns = document.querySelectorAll('.tab-nav-btn');
        const views = document.querySelectorAll('.app-view');
        const gamesContainer = document.getElementById('gamesContainer');
        const moviesContainer = document.getElementById('moviesContainer');
        const gameSearchInput = document.getElementById('gameSearchInput');
        const movieSearchInput = document.getElementById('movieSearchInput');
        const gameTabBtns = document.querySelectorAll('.tab-btn-game');
        
        const gameInfoModal = document.getElementById('gameInfoModal');
        const modalPlayBtn = document.getElementById('modalPlayBtn');
        const modalFavBtn = document.getElementById('modalFavBtn');
        
        const mediaPlayer = document.getElementById('media-player');
        const mediaFrame = document.getElementById('mediaFrame');
        const backBtn = document.getElementById('backBtn');
        const fullscreenBtn = document.getElementById('fullscreenBtn');
        
        const welcomeBanner = document.getElementById('welcome-banner'); // NEW
        const toast = document.getElementById('toast-notification'); // NEW
        const confirmModal = document.getElementById('confirm-modal'); // NEW
        const confirmMessage = document.getElementById('confirm-message'); // NEW
        const confirmBtnYes = document.getElementById('confirm-btn-yes'); // NEW
        const confirmBtnNo = document.getElementById('confirm-btn-no'); // NEW
        const editModal = document.getElementById('edit-modal'); // NEW
        const editForm = document.getElementById('editForm'); // NEW
        
        let currentGamesCategory = filters.gameCategory;
        let confirmCallback = null; // NEW: Store callback for confirm modal

        // --- NAVIGATION & VIEWS ---
        function changeView(viewId) {
            saveFilterState(); 
            
            views.forEach(view => view.classList.remove('active'));
            tabBtns.forEach(btn => btn.classList.remove('active'));

            const targetView = document.getElementById(`${viewId}-view`);
            targetView.classList.add('active');
            
            const targetBtn = document.querySelector(`.tab-nav-btn[data-view="${viewId}"]`);
            if (targetBtn) {
                targetBtn.classList.add('active');
            }
            
            // This is handled by the global click listener now
            // activeAdminMenu = null;
            // document.querySelectorAll('.admin-card-menu').forEach(menu => menu.remove());

            const isAdminView = viewId === 'admin';
            document.querySelectorAll('.admin-tools-btn').forEach(btn => {
                btn.classList.toggle('active', isAdminView);
            });

            if (viewId === 'home') {
                renderHomeContent();
            } else if (viewId === 'games') {
                loadAndRenderGames(); 
            } else if (viewId === 'movies') {
                loadAndRenderMovies(); 
            } else if (viewId === 'info') {
                renderInfoModal('player-counter'); 
            }
        }

        tabBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                changeView(btn.dataset.view);
            });
        });
        
        // --- NEW: NOTIFICATION & MODAL FUNCTIONS ---
        
        function showToast(message, type = 'success') {
            toast.textContent = message;
            toast.className = 'show'; // Remove all other classes first
            toast.classList.add(type); // Add success or error
            
            setTimeout(() => {
                toast.className = ''; // Hide
            }, 3000);
        }
        
        function showConfirm(message, callback) {
            confirmMessage.textContent = message;
            confirmCallback = callback;
            confirmModal.style.display = 'flex';
            
            confirmBtnYes.onclick = () => {
                hideConfirm();
                if (confirmCallback) confirmCallback(true);
            };
            confirmBtnNo.onclick = () => {
                hideConfirm();
                if (confirmCallback) confirmCallback(false);
            };
        }
        
        function hideConfirm() {
            confirmModal.style.display = 'none';
            confirmCallback = null;
        }

        function hideEditModal() {
            editModal.style.display = 'none';
            editForm.reset();
            document.getElementById('edit-error').textContent = '';
        }
        
        // --- MODAL FUNCTIONS (Credits & Game Info) ---
        const creditModal = document.getElementById('credit-modal');
        function showCredits() { creditModal.style.display = 'flex'; }
        function hideCredits() { creditModal.style.display = 'none'; }
        
        let currentGameDataForModal = null;
        
        function showGameInfoModal(item) {
            currentGameDataForModal = item;
            
            document.getElementById('gameInfoIcon').src = item.icon;
            document.getElementById('gameInfoName').textContent = item.name;
            document.getElementById('gameInfoCategory').textContent = item.category;
            document.getElementById('gameInfoPlayCount').textContent = item.playCount;
            document.getElementById('gameInfoDescription').textContent = item.description || 'No description provided.';
            
            const isFav = favorites.includes(item.id);
            modalFavBtn.classList.toggle('favorited', isFav);
            // This was a bug, style.borderColor doesn't work on the base class
            modalFavBtn.classList.toggle('!border-red-500', isFav);
            modalFavBtn.classList.toggle('!text-red-500', isFav);
            
            document.getElementById('modalFavText').textContent = isFav ? 'Remove from Favorites' : 'Add to Favorites';
            
            modalPlayBtn.onclick = () => {
                hideGameInfoModal();
                openMedia(item, true);
            };
            modalFavBtn.onclick = () => {
                toggleFavorite(item.id, 'game');
                // Re-fetch item data as it might have changed (though not in this case, good practice)
                const updatedItem = getGameData(item.id);
                showGameInfoModal(updatedItem); 
            };
            
            gameInfoModal.style.display = 'flex';
        }
        function hideGameInfoModal() {
            gameInfoModal.style.display = 'none';
        }


        // --- PARTICLE SYSTEM ---
        const canvas = document.getElementById('particle-canvas');
        const ctx = canvas.getContext('2d');
        let particles = [];
        
        class Particle { 
            constructor(x, y, radius, color) {
                this.x = x;
                this.y = y;
                this.radius = radius;
                this.color = color;
                this.velocity = {
                    x: (Math.random() - 0.5) * 0.5,
                    y: (Math.random() - 0.5) * 0.5
                };
            }
            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2, false);
                ctx.fillStyle = this.color;
                ctx.fill();
            }
            update() {
                if (this.x + this.radius > canvas.width || this.x - this.radius < 0) {
                    this.velocity.x = -this.velocity.x;
                }
                if (this.y + this.radius > canvas.height || this.y - this.radius < 0) {
                    this.velocity.y = -this.velocity.y;
                }
                this.x += this.velocity.x;
                this.y += this.velocity.y;
                this.draw();
            }
        }
        
        function initParticles() { 
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            particles = [];
            const numParticles = Math.floor(canvas.width * canvas.height / 15000); 
            for (let i = 0; i < numParticles; i++) {
                const radius = Math.random() * 2 + 1;
                const x = Math.random() * (canvas.width - radius * 2) + radius;
                const y = Math.random() * (canvas.height - radius * 2) + radius;
                const color = 'rgba(0, 255, 255, 0.7)';
                particles.push(new Particle(x, y, radius, color));
            }
        } 

        let animationId;
        function animate() { 
            animationId = requestAnimationFrame(animate);
            ctx.fillStyle = 'rgba(13, 13, 13, 0.5)'; 
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            particles.forEach(particle => {
                particle.update();
            });
        } 
        
        // --- CARD RENDERER (Generic Helper) ---
        function createCard(item, isGame, container, index, isSmall = false, searchTerm = '') {
            const id = item.id;
            const isFav = favorites.includes(id); // Check favorites for both types
            const card = document.createElement("div");
            card.className = "content-card";
            card.setAttribute('data-id', id);
            card.setAttribute('data-type', isGame ? 'game' : 'movie');
            
            const imgContainerStyle = isSmall ? 'height: 120px;' : (isGame ? 'height: 150px;' : '');

            let heartHtml = `
                <div class="favorite-btn ${isFav ? 'favorited' : ''}" onclick="event.stopPropagation(); toggleFavorite('${id}', '${isGame ? 'game' : 'movie'}')">
                    <i class="fas fa-heart"></i>
                </div>
            `;
            
            let adminHtml = `
                <div class="admin-tools-btn" onclick="event.stopPropagation(); toggleAdminMenu('${id}', '${isGame ? 'game' : 'movie'}')">
                    <i class="fas fa-wrench"></i>
                </div>
            `;
            
            let itemName = item.name;
            if (searchTerm) {
                const regex = new RegExp(`(${searchTerm})`, 'gi');
                itemName = itemName.replace(regex, '<span class="highlight">$1</span>');
            }

            card.innerHTML = `
                <div class="card-img-container" style="${imgContainerStyle}">
                    ${heartHtml}
                    ${adminHtml}
                    <div class="card-overlay"><i class="fa-solid fa-play"></i></div>
                    <img src="${isGame ? item.icon : item.poster}" alt="${item.name}" onerror="this.onerror=null;this.src='https://placehold.co/200x300/0d0d0d/00ffff?text=Image+Missing';">
                </div>
                <h3>${itemName}</h3>
            `;
            
            if (isGame && !isSmall) {
                card.onclick = () => showGameInfoModal(item); 
            } else {
                card.onclick = () => openMedia(item, isGame);
            }
            
            container.appendChild(card);
            
            if (!isSmall) {
                setTimeout(() => { card.classList.add('visible'); }, index * 50);
            } else {
                card.classList.add('visible');
            }

            const currentView = filters.lastView;
            card.querySelector('.admin-tools-btn').classList.toggle('active', currentView === 'admin');
        }
        
        
        // --- Admin Tools Menu Logic ---
        function toggleAdminMenu(id, type) {
            const card = document.querySelector(`.content-card[data-id="${id}"]`);
            
            document.querySelectorAll('.admin-card-menu').forEach(menu => menu.remove());
            
            if (activeAdminMenu === id) {
                activeAdminMenu = null;
                return;
            }

            const menu = document.createElement('div');
            menu.className = 'admin-card-menu';
            
            let menuHtml = `
                <button onclick="editContent('${id}', '${type}')"><i class="fas fa-edit mr-2"></i> Edit Details</button>
                <button onclick="deleteContent('${id}', '${type}')"><i class="fas fa-trash-alt mr-2"></i> Delete Content</button>
            `;
            
            if (type === 'game') {
                menuHtml += `
                    <button onclick="resetPlayCount('${id}')"><i class="fas fa-chart-line mr-2"></i> Reset Play Count</button>
                `;
            }
            
            menu.innerHTML = menuHtml;
            card.appendChild(menu);
            activeAdminMenu = id;
            
            setTimeout(() => {
                document.addEventListener('click', closeAdminMenuGlobally, { once: true });
            }, 1);
        }
        
        function closeAdminMenuGlobally(event) {
            if (activeAdminMenu && !event.target.closest('.admin-card-menu')) {
                 document.querySelectorAll('.admin-card-menu').forEach(menu => menu.remove());
                 activeAdminMenu = null;
            }
        }
        
        function resetPlayCount(id) {
            document.querySelectorAll('.admin-card-menu').forEach(menu => menu.remove());
            activeAdminMenu = null;
            
            const gameIndex = games.findIndex(g => g.id === id);
            if (gameIndex !== -1) {
                games[gameIndex].playCount = 0;
                saveContentToStorage();
                showToast(`${games[gameIndex].name} play count reset.`);
                loadAndRenderGames();
            }
        }

        // --- HOME VIEW CONTENT LOGIC ---
        function renderHomeContent() {
            // Render Recently Played
            const recentGames = recentlyPlayed.map(id => getGameData(id)).filter(g => g);
            recentlyPlayedContainer.innerHTML = recentGames.length === 0 
                ? `<div class="empty-state">No games played yet. Go play something!</div>`
                : '';
            recentGames.forEach((g, index) => createCard(g, true, recentlyPlayedContainer, index, true));

            // Render Favorite Games (NOW SHOWS MOVIES TOO)
            const favoriteItems = favorites.map(id => {
                return getContentData(id, id.startsWith('game') ? 'game' : 'movie');
            }).filter(i => i);
            
            favoriteGamesContainer.innerHTML = favoriteItems.length === 0
                ? `<div class="empty-state">Heart some games or movies to see them here!</div>`
                : '';
            favoriteItems.forEach((item, index) => {
                 const isGame = item.id.startsWith('game');
                 createCard(item, isGame, favoriteGamesContainer, index, true)
            });
        }
        
        // --- GAMES VIEW LOGIC ---
        function loadAndRenderGames() {
            gameSearchInput.value = filters.gameSearch;
            currentGamesCategory = filters.gameCategory;
            
            document.querySelectorAll('.tab-btn-game').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.category === currentGamesCategory) {
                    btn.classList.add('active');
                }
            });
            renderGames();
        }

        function renderGames() {
            const searchTerm = gameSearchInput.value.toLowerCase();
            filters.gameSearch = searchTerm; 
            
            const filteredGames = games.filter(g => {
                const inCategory = currentGamesCategory === 'All' || g.category === currentGamesCategory;
                // NEW: Search description as well
                const matchesSearch = g.name.toLowerCase().includes(searchTerm) || g.description.toLowerCase().includes(searchTerm);
                return inCategory && matchesSearch;
            });

            gamesContainer.innerHTML = "";
            filteredGames.forEach((g, index) => createCard(g, true, gamesContainer, index, false, searchTerm));
            saveFilterState();
        }
        
        gameSearchInput.addEventListener("input", renderGames);
        
        gameTabBtns.forEach(btn => {
            btn.addEventListener('click', (e) => {
                document.querySelector('.tab-btn-game.active').classList.remove('active');
                e.target.classList.add('active');
                currentGamesCategory = e.target.dataset.category;
                filters.gameCategory = currentGamesCategory; 
                renderGames();
            });
        });


        // --- MOVIES VIEW LOGIC ---
        function loadAndRenderMovies() {
            movieSearchInput.value = filters.movieSearch;
            renderMovies();
        }

        function renderMovies() {
            const searchTerm = movieSearchInput.value.toLowerCase();
            filters.movieSearch = searchTerm; 

            const filteredMovies = movies.filter(m => {
                 // NEW: Search description as well
                return m.name.toLowerCase().includes(searchTerm) || m.description.toLowerCase().includes(searchTerm);
            });

            moviesContainer.innerHTML = "";
            filteredMovies.forEach((m, index) => createCard(m, false, moviesContainer, index, false, searchTerm));
            saveFilterState();
        }
        
        movieSearchInput.addEventListener("input", renderMovies);
        
        // --- ADMIN PANEL & CONTENT CRUD LOGIC ---
        
        function isValidUrl(string) {
            try {
                new URL(string);
                return true;
            } catch (e) {
                return false;
            }
        }

        function addContent(type, form) {
            const formData = new FormData(form);
            const url = formData.get('url');
            const errorElement = document.getElementById(type + '-error');
            errorElement.textContent = '';

            if (!isValidUrl(url)) {
                errorElement.textContent = 'Error: The URL provided is not a valid web address.';
                return;
            }
            if (type === 'game' && !isValidUrl(formData.get('icon'))) {
                 errorElement.textContent = 'Error: The Game Icon URL is not a valid web address.';
                return;
            }
            if (type === 'movie' && !isValidUrl(formData.get('poster'))) {
                 errorElement.textContent = 'Error: The Movie Poster URL is not a valid web address.';
                return;
            }

            const newEntry = {
                name: formData.get('name'),
                description: formData.get('description'),
                url: url,
                id: type + '-' + Date.now().toString(36) + Math.random().toString(36).substr(2, 5)
            };
            
            if (type === 'game') {
                newEntry.icon = formData.get('icon');
                newEntry.category = formData.get('category');
                newEntry.playCount = 0; 
                games.unshift(newEntry);
            } else if (type === 'movie') {
                newEntry.poster = formData.get('poster');
                movies.unshift(newEntry);
            }
            
            saveContentToStorage();
            showToast(`${newEntry.name} successfully added!`, 'success');
            
            form.reset();
            loadAndRenderGames();
            loadAndRenderMovies();
            renderHomeContent();
        }
        
        function deleteContent(id, type) {
            // NEW: Use custom confirm modal
            const item = getContentData(id, type);
            const itemName = item ? item.name : `this ${type}`;
            
            showConfirm(`Are you sure you want to delete "${itemName}"? This cannot be undone.`, (confirmed) => {
                if (confirmed) {
                    if (type === 'game') {
                        games = games.filter(g => g.id !== id);
                        favorites = favorites.filter(favId => favId !== id);
                        recentlyPlayed = recentlyPlayed.filter(recId => recId !== id);
                        loadAndRenderGames();
                    } else {
                        movies = movies.filter(m => m.id !== id);
                        favorites = favorites.filter(favId => favId !== id);
                        loadAndRenderMovies();
                    }
                    
                    saveContentToStorage();
                    renderHomeContent();
                    showToast(`"${itemName}" was deleted.`, 'error');
                }
            });
        }
        
        // NEW: Full Edit Functionality
        function editContent(id, type) {
            const item = getContentData(id, type);
            if (!item) return;

            const isGame = (type === 'game');
            
            // Populate form
            document.getElementById('edit-id').value = id;
            document.getElementById('edit-type').value = type;
            document.getElementById('edit-name').value = item.name;
            document.getElementById('edit-description').value = item.description;
            document.getElementById('edit-url').value = item.url;
            
            document.getElementById('edit-image-label').textContent = isGame ? 'Icon URL:' : 'Poster URL:';
            document.getElementById('edit-image-url').value = isGame ? item.icon : item.poster;
            
            const categoryGroup = document.getElementById('edit-category-group');
            categoryGroup.style.display = isGame ? 'block' : 'none';
            if (isGame) {
                document.getElementById('edit-category').value = item.category;
            }
            
            editModal.style.display = 'flex';
            document.querySelectorAll('.admin-card-menu').forEach(menu => menu.remove());
            activeAdminMenu = null;
        }

        // NEW: Handle the edit form submission
        function handleEditSubmit(form) {
            const formData = new FormData(form);
            const id = formData.get('id');
            const type = formData.get('type');
            const isGame = (type === 'game');
            const errorElement = document.getElementById('edit-error');
            errorElement.textContent = '';
            
            // Validation
            const url = formData.get('url');
            const imageUrl = formData.get('imageUrl');
            if (!isValidUrl(url)) {
                errorElement.textContent = 'Error: The Game/Movie URL is not valid.';
                return;
            }
            if (!isValidUrl(imageUrl)) {
                errorElement.textContent = 'Error: The Icon/Poster URL is not valid.';
                return;
            }

            // Find and update item
            let item;
            if (isGame) {
                item = games.find(g => g.id === id);
                if (item) {
                    item.name = formData.get('name');
                    item.description = formData.get('description');
                    item.url = url;
                    item.icon = imageUrl;
                    item.category = formData.get('category');
                }
            } else {
                item = movies.find(m => m.id === id);
                 if (item) {
                    item.name = formData.get('name');
                    item.description = formData.get('description');
                    item.url = url;
                    item.poster = imageUrl;
                }
            }

            if (item) {
                saveContentToStorage();
                hideEditModal();
                showToast(`${item.name} updated successfully!`, 'success');
                
                // Re-render everything
                loadAndRenderGames();
                loadAndRenderMovies();
                renderHomeContent();
            } else {
                 errorElement.textContent = 'Error: Could not find item to update.';
            }
        }


        // --- INFO VIEW LOGIC ---
        function getMostPlayedGame() {
            if (games.length === 0) return null;
            const mostPlayed = games.reduce((max, game) => (game.playCount > (max ? max.playCount : -1) ? game : max), null);
            return mostPlayed && mostPlayed.playCount > 0 ? mostPlayed : null;
        }

        function renderPlayerCounter() {
            const mostPlayed = getMostPlayedGame();
            const mostPlayedJson = mostPlayed ? JSON.stringify(mostPlayed).replace(/"/g, "'") : null;
            
            let mostPlayedHtml = `<p class="text-gray-400 mt-2 text-center">No games have been played yet.</p>`;

            if (mostPlayed) {
                mostPlayedHtml = `
                    <div class="mt-4 p-4 border border-blue-500 rounded-xl bg-gray-800 transition-shadow duration-300 hover:shadow-cyan-400/50 hover:shadow-2xl">
                        <h4 class="text-xl font-bold mb-3 text-blue-400"><i class="fas fa-trophy mr-2"></i> Most Played Game (${mostPlayed.playCount} Visits)</h4>
                        <div class="flex items-center space-x-4 cursor-pointer p-2 rounded-lg bg-gray-700/50" onclick="showGameInfoModal(${mostPlayedJson})">
                            <img src="${mostPlayed.icon}" alt="${mostPlayed.name}" class="w-16 h-16 object-cover rounded-md border-2 border-blue-500">
                            <span class="text-lg font-semibold">${mostPlayed.name} <i class="fas fa-external-link-alt ml-2 text-sm"></i></span>
                        </div>
                    </div>
                `;
            }

            return `
                <h3 class="text-2xl font-bold text-center mb-6 text-cyan-400 border-b pb-2 border-cyan-400/50">Player Session Stats</h3>
                <div class="bg-gray-700 p-6 rounded-xl shadow-lg border-2 border-gray-600">
                    <p class="text-lg mb-4"><i class="fas fa-users text-cyan-400 mr-3"></i> Total Sessions Recorded:</p>
                    <p class="text-6xl font-black text-center text-white text-shadow-lg">${sessionCount}</p>
                </div>
                ${mostPlayedHtml}
                <p class="text-xs mt-4 text-gray-500 italic text-center">Note: This tracks page loads/visits on this device. IP address tracking is not possible in this application for security and privacy reasons.</p>
            `;
        }

        function renderOwners() {
            return `
                <h3 class="text-2xl font-bold text-center mb-6 text-red-400 border-b pb-2 border-red-400/50">Owners & Partners</h3>
                <div class="space-y-6">
                    <div class="bg-gray-700 p-4 rounded-lg flex items-center shadow-md border-2 border-red-700">
                        <i class="fas fa-crown text-yellow-500 text-3xl mr-4"></i>
                        <div>
                            <p class="text-xl font-bold text-white">Owner: Kelvin / _648k</p>
                            <p class="text-sm text-gray-400">The hub creator and lead developer.</p>
                        </div>
                    </div>
                    
                    <div class="bg-gray-700 p-4 rounded-lg flex items-center shadow-md border-2 border-pink-700">
                        <img src="https://codehs.com/uploads/b7b0c2a6ef30c436d3b1e8d047f9ea4f" alt="FlipBoi Logo" class="w-12 h-12 object-cover rounded-full mr-4 border-2 border-pink-500">
                        <div>
                            <p class="text-xl font-bold text-white">Partner: FlipBoi</p>
                            <p class="text-sm text-gray-400">Collaborator and content curator.</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderInfoModal(tabName) {
            document.querySelectorAll('.info-tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            const activeBtn = document.querySelector(`.info-tab-btn[data-tab="${tabName}"]`);
            if (activeBtn) { activeBtn.classList.add('active'); }


            const contentArea = document.getElementById('infoContentArea');
            contentArea.style.opacity = '0'; 
            
            setTimeout(() => {
                switch (tabName) {
                    case 'player-counter':
                        contentArea.innerHTML = renderPlayerCounter();
                        break;
                    case 'owners':
                        contentArea.innerHTML = renderOwners();
                        break;
                    default:
                        contentArea.innerHTML = renderPlayerCounter(); 
                        break;
                }
                contentArea.style.opacity = '1'; 
            }, 200);
        }

        // --- MEDIA PLAYER LOGIC (Unified) ---
        function openMedia(item, isGame) {
            let mediaUrl = item.url;
            
            if (isGame) {
                logRecentGame(item.id);
                const gameIndex = games.findIndex(g => g.id === item.id);
                if (gameIndex !== -1) {
                    games[gameIndex].playCount = (games[gameIndex].playCount || 0) + 1;
                    saveContentToStorage(); 
                }
            } else if (item.url.includes("drive.google.com") && !item.url.includes("/preview")) {
                const fileIdMatch = item.url.match(/\/d\/([a-zA-Z0-9_-]+)/);
                if (fileIdMatch && fileIdMatch[1]) {
                    const fileId = fileIdMatch[1];
                    mediaUrl = `https://drive.google.com/file/d/${fileId}/preview`;
                }
            }

            mediaFrame.src = mediaUrl;
            mediaPlayer.style.display = "flex";
        }

        backBtn.onclick = () => {
            mediaPlayer.style.display = "none";
            mediaFrame.src = ""; 
        };

        fullscreenBtn.onclick = () => {
            const elem = mediaPlayer;
            if (elem.requestFullscreen) {
                elem.requestFullscreen();
            } else if (elem.webkitRequestFullscreen) {
                elem.webkitRequestFullscreen();
            } else if (elem.msRequestFullscreen) {
                elem.msRequestFullscreen();
            }
        };
        
        // --- PWA INSTALL PROMPT LOGIC ---
        let deferredInstallPrompt = null;
        const installAppBtn = document.getElementById('installAppBtn');

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredInstallPrompt = e;
            installAppBtn.style.display = 'block';
        });

        function handleInstallPrompt() {
            if (deferredInstallPrompt) {
                deferredInstallPrompt.prompt();
                deferredInstallPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        showToast('App installed successfully!', 'success');
                    } else {
                        showToast('App install cancelled.', 'error');
                    }
                    deferredInstallPrompt = null;
                    installAppBtn.style.display = 'none';
                });
            }
        }
        
        window.addEventListener('appinstalled', () => {
            installAppBtn.style.display = 'none';
        });


        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => { 
             loadContentFromStorage(); 
             incrementSessionCount(); 
             initParticles(); 
             animate();
             
             const initialView = filters.lastView;
             changeView(initialView);
             
             // --- NEW: Listeners for editable welcome banner ---
             welcomeBanner.addEventListener('click', () => {
                if(document.querySelector('.app-view.active')?.id === 'home-view') {
                    welcomeBanner.contentEditable = true;
                    welcomeBanner.focus();
                    document.execCommand('selectAll', false, null);
                }
             });
             
             welcomeBanner.addEventListener('blur', () => {
                welcomeBanner.contentEditable = false;
                const newName = welcomeBanner.textContent.replace('Welcome,', '').replace('!', '').trim();
                username = newName || 'User'; // Fallback
                welcomeBanner.textContent = `Welcome, ${username}!`;
                saveContentToStorage();
                showToast('Username updated!', 'success');
             });
             
             welcomeBanner.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    welcomeBanner.blur();
                }
             });
        });
        window.addEventListener('resize', initParticles);
        
        // Global click handler is now added/removed by toggleAdminMenu
        
    </script>
</body>
</html>
